---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by lele.
--- DateTime: 15/04/23 13:52
---

local characterPz = require("lib/CharacterPZ")
local perkFactoryPZ = require("lib/PerkFactoryPZ")
local characterLib = require("CharacterLib")
local modDataManager = require("lib/ModDataManager")

require("EnumModData")
require("lib/CharacterBaseObj")

--- **Read Character Perk Details From Hd**
---@return CharacterBaseObj PerkFactory.Perk perk, int level, float xp, boolean flag
local function readCharacterPerkDetailsFromHd()
    local characterPerkDetails =
        modDataManager.read(EnumModData.CHARACTER_PERK_DETAILS )

    local CharacterObj01 = CharacterBaseObj:new()

    local lines_ = {}

    for _, v in pairs(characterPerkDetails) do
        for s in v:gmatch("[^\r-]+") do
            table.insert(lines_, s)
        end

        -- perk, level, xp
        CharacterObj01:addPerkDetails(perkFactoryPZ.getPerkByName_PZ(lines_[1]),
                tonumber(lines_[2]),
                tonumber(lines_[3]) + 0.0)

        lines_ = {}
    end

    return CharacterObj01
end

--- **Delete  all skills Character**
---@param character IsoGameCharacter
--- - IsoGameCharacter : zombie.characters.IsoGameCharacter
local function deleteCharacter(character)
    local characterAllSkills = CharacterBaseObj:new()

    characterAllSkills = characterLib.getAllPerks(character)

    for _, v in pairs(characterAllSkills:getPerkDetails()) do
        characterPz.removePerkLevel(character, v:getPerk())
    end

    characterPz.removeProfession(character)
end

--- **Copy Character Skill**
---@param character IsoGameCharacter
--- - IsoGameCharacter : zombie.characters.IsoGameCharacter
function createCharacterPerkDetails(character)
    if not modDataManager.isExists(EnumModData.CHARACTER_PROFESSION) or not
            modDataManager.isExists(EnumModData.CHARACTER_PERK_DETAILS) then
        return nil
    end

    local characterSkills = CharacterBaseObj:new()
    characterSkills = readCharacterPerkDetailsFromHd()

    deleteCharacter(character)

    for _, v in pairs(characterSkills:getPerkDetails()) do
        characterPz.setPerkLevelFromXp(character, v:getPerk(), v:getXp())
    end

    local profession = {}
    profession = modDataManager.read(EnumModData.CHARACTER_PROFESSION)

    characterPz.setProfession_PZ(character,
            profession[1])
end

--- **Write Character Perk Details To Hd**
---@param character IsoGameCharacter
--- - IsoGameCharacter : zombie.characters.IsoGameCharacter
function writeCharacterPerkDetailsToHd(character)
    modDataManager.remove(EnumModData.CHARACTER_PERK_DETAILS )
    modDataManager.remove(EnumModData.CHARACTER_PROFESSION )

    local lines = {}

    local characterAllSkills = CharacterBaseObj:new()
    characterAllSkills = characterLib.getAllPerks(character)

    for _, v in pairs(characterAllSkills:getPerkDetails()) do
        local value = ( v.perk:getName() .. "-" ..
                tostring(v:getLevel())  .. "-" ..
                tostring(v:getXp()) )

        table.insert(lines, value)
    end

    modDataManager.save(EnumModData.CHARACTER_PERK_DETAILS, lines)

    lines = {}
    modDataManager.save(EnumModData.CHARACTER_PROFESSION,
            characterAllSkills:getProfession() )
end




