---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by lele.
--- DateTime: 15/04/23 13:52
---

require("media.lua.client.EnumModData")
require("media.lua.shared.objects.CharacterObj")

---Read Character Perk Details From Hd
---@return CharacterObj PerkFactory.Perk perk, int level, float xp, boolean flag
local function readCharacterPerkDetailsFromHd()
    local characterPerkDetails =
    ModData.get(EnumModData.CHARACTER_PERK_DETAILS )

    local CharacterObj01 = CharacterObj:new()

    local lines = {}

    for _, v in pairs(characterPerkDetails) do
        for s in v:gmatch("[^\r-]+") do
            table.insert(lines, s)
        end

        -- perk, level, xp
        CharacterObj01:addPerkDetails(getPerkFromName_PZ(lines[1]),
                tonumber(lines[2]),
                tonumber(lines[3]) + 0.0)

        lines = {}
    end

    return CharacterObj01
end

---Delete  all skills Character
---@param character IsoGameCharacter
--- - IsoGameCharacter : zombie.characters.IsoGameCharacter
local function deleteCharacter(character)
    local characterAllSkills = CharacterObj:new()

    characterAllSkills = getCharacterAllSkills(character)

    for _, v in pairs(characterAllSkills:getPerkDetails()) do
        removePerkLevel(character, v:getPerk())
    end

    setCharacterProfession_PZ(character, "")
end

---Copy Character Skill
---@param character IsoGameCharacter
--- - IsoGameCharacter : zombie.characters.IsoGameCharacter
function createCharacterPerkDetails(character)
    if not modDataIsExist(EnumModData.CHARACTER_PROFESSION) or not
            modDataIsExist(EnumModData.CHARACTER_PERK_DETAILS) then
        return nil
    end

    local characterSkills = CharacterObj:new()
    characterSkills = readCharacterPerkDetailsFromHd()

    deleteCharacter(character)

    for _, v in pairs(characterSkills:getPerkDetails()) do
        setPerkLevel(character, v:getPerk(), v:getXp())
    end

    setCharacterProfession_PZ(character,
        modDataReadSingleValue(EnumModData.CHARACTER_PROFESSION))
end

---Write Character Perk Details To Hd
---@param character IsoGameCharacter
--- - IsoGameCharacter : zombie.characters.IsoGameCharacter
function writeCharacterPerkDetailsToHd(character)
    ModData.remove(EnumModData.CHARACTER_PERK_DETAILS )

    local lines = {}

    local characterAllSkills = CharacterObj:new()
    characterAllSkills = getCharacterAllSkills(character)

    for i, v in pairs(characterAllSkills:getPerkDetails()) do
        lines[i] = ( v.perk:getName() .. "-" ..
                tostring(v:getLevel())  .. "-" ..
                tostring(v:getXp()) )
        -- TODO replace with modDataInsertSingleValue
        ModData.add(EnumModData.CHARACTER_PERK_DETAILS, lines)
    end

    lines = {}

    modDataInsertSingleValue(EnumModData.CHARACTER_PROFESSION, characterAllSkills:getProfession() )
end




